<meta name="viewport"
	content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta charset="UTF-8">

<div data-role="page" id="wallPage">
	<script type="text/javascript">
		var increaseNumber;
		var pageMaster;
		$("#wallPage").on(
				"pageinit",
				function() {
					var pageParams = $.stageComponent.pageParam();
					var currentLoginId = $.stage.component.getSession();

					increaseNumber = 0;
					pageMaster = "testimage";
					console.log("userID : " + currentLoginId.userId);

					$("#id_header").html("@" + pageMaster);
					getInforList(0);
					//	$("#back").click(function() {
					//		$.stageComponent.pageMove("../talk/talkList.html",{}, currentLoginId.userId);
					//		});
					$("#submitButton").bind("click", function() {
						var text = $("#insertText").val();
						if (text == "" || text == " ")
							;
						else
							setInforList(text);

					});
					$("#content .mine").live(
							"click",
							function() {
								var id = this.id;
								var index = id.split("/");
								if (currentLoginId.userId == 'testimage'
										|| currentLoginId.userId == index[2]) {

									var answer = confirm("선택한 글을 삭제할까요?");
									if (answer == true) {
										$(this).remove();
										deleteSeleteWall(this.id);
									}
								}
							});
					$("#content .others").live(
							"click",
							function() {
								var id = this.id;
								var index = id.split("/");

								if (currentLoginId.userId == 'testimage'
										|| currentLoginId.userId == index[2]) {

									var answer = confirm("선택한 글을 삭제할까요?");
									if (answer == true) {
										$(this).remove();
										deleteSeleteWall(this.id);
									}
								}
							});
					$("#list").bind("click", function() {

					});

				});

		//리스트 가져오기 처음 시작할때
		function getInforList(start) {

			var inforUrl = $.stage.restPool.GET_USER_INFORM;
			var currentLoginId = $.stage.component.getSession();
			var url = "http://specificconcept.cafe24.com/rest/userWall";

			var params = {
				userId : 'testimage',
				listIndex : start,
				listCount : 10
			};

			$.stage.ajax.getJson(url, params, function(data) {

				for ( var a = 0; a < 10; a++) {
					if (data.list[a] == null)
						break;
					listLoad(data.list[a].writerId, a, data);

				}

			}, true);
			$.mobile.hidePageLoadingMsg();
		}

		//리스트 추가시키는것...
		function listLoad(writerId, count, information) {

			$.mobile.showPageLoadingMsg("b", "loading...", true);
			var currentLoginId = $.stage.component.getSession();
			var writerImage;

			var inforUrl = $.stage.restPool.GET_USER_INFORM;
			var writerParams = {
				userId : writerId
			};

			var ids = information.list[count].idx + "/"
					+ information.list[count].userId + "/"
					+ information.list[count].writerId;
			$.stage.ajax
					.getJson(
							inforUrl,
							writerParams,
							function(data) {
								writerImage = data.data.thumnail;
								if (writerImage == null)
									writerImage = "gravatar.jpg";
								if (currentLoginId.userId == information.list[count].writerId) {
									$("<div class='mine' "+"id="+ids+">")
											.appendTo("#wallList")
											.html(
													'<div id="mine_text">'
															+ '<font id="ID"><b>ID: </b>'
															+ information.list[count].writerId
															+ '</font><br/><b>Comment: </b>'
															+ information.list[count].comment
															+ '</div><img src='+ writerImage+' id="mine_img">');

								} else {
									$("<div class='others' "+"id="+ids+">")
											.appendTo("#wallList")
											.html(
													'<div id="others_text">'
															+ '<font id="ID">ID: '
															+ information.list[count].writerId
															+ '</font><br/>Comment: '
															+ information.list[count].comment
															+ '</div><img src='+ writerImage+' id="others_img">');

								}
								//	$("#wallList").listview("refresh");
								$.mobile.hidePageLoadingMsg();
							}, true);

		}

		function setInforList(content) {
			$.mobile.showPageLoadingMsg("b", "loading...", true);
			var currentLoginId = $.stage.component.getSession();
			var url = "http://specificconcept.cafe24.com/rest/userWall";
			var params = {
				userId : 'testimage',
				writerId : currentLoginId.userId,
				comment : content
			};
			$.stage.ajax.postJson(url, params, function(data) {
				$("#wallList").html("");
				$("#insertText").val("");
				getInforList(0);
			}, true);
		}

		// 더보기 기능
		function addInforList() {
			increaseNumber += 10;
			getInforList(increaseNumber);

		}
		function deleteSeleteWall(ids) {
			var currentLoginId = $.stage.component.getSession();
			$.mobile.showPageLoadingMsg("b", "loading...", true);
			var index = ids.split("/");
			deleteWall(index[0], index[1], index[2]);
			//idx userId writerId
			$.mobile.hidePageLoadingMsg();

		}

		function deleteWall(id, user, writer) {
			var delete_url = "http://specificconcept.cafe24.com/rest/userWall/delete/";
			delete_url += id;
			var delete_params = {
				userId : user,
				writerId : writer
			};

			$.stage.ajax.postJson(delete_url, delete_params, function(data) {

			}, true);
		}

		$(window).scroll(
				function() {

					if ($(window).scrollTop() == $(document).height()
							- $(window).height()) {
						$.mobile.showPageLoadingMsg("b", "loading...", true);
						addInforList();
					}
				});
	</script>


	<style>
#wallPage {
	background-image: url(cssimage/back_bg.png);
}

#header {
	height: 10%;
	background-image: url(cssimage/header_bg.png);
	text-align: center;
}

#content {
	
}

#title {
	text-align: center;
}

.others {
	overflow: auto;
	height: 14%;
	margin-top: 1%;
	margin-bottom: 1%;
}

#others_text {
	margin: 2%;
	margin-top: 2.5%;
	margin-right: 4%;
	padding: 2%;
	width: 60%;
	text-align: left;
	float: right;
	background-color: gray;
	opacity: 0.6;
	border-radius: 6px;
	box-shadow: inset -2% -2% 2% 2% black;
}

#others_img {
	overflow: auto;
	margin: 2%;
	margin-top: 2.5%;
	margin-left: 4%;
	border-radius: 10px;
}

.mine {
	overflow: auto;
	height: 14%;
	margin-top: 1%;
	margin-bottom: 1%;
}

#mine_text {
	margin: 2%;
	margin-top: 2.5%;
	margin-left: 4%;
	padding: 2%;
	width: 60%;
	text-align: left;
	float: left;
	background-color: gray;
	opacity: 0.6;
	border-radius: 6px;
	box-shadow: inset -5% -5% 5% 5% black;
}

#mine_img {
	float: right;
	margin: 2%;
	margin-top: 2.5%;
	margin-left: 0;
	margin-right: 4%;
	border-radius: 10px;
}

#ID {
	color: red;
}

#footer {
	background-image: url(cssimage/header_bg.png);
	height: 11%;
}

#footer ul {
	list-style-type: none;
	margin: 0px;
	padding: 0px;
}

#footer ul li {
	height: 100%;
}

#footer ul li #mainStalkButton {
	background: url(cssimage/stalk_icon.png) 50% 50% no-repeat;
	width: 64px;
	height: 55px;
	float: left;
	background-size: 92%;
}

#footer ul li #mainStalkButton:hover {
	background: url(cssimage/tap_stalk_icon.png) 50% 50% no-repeat;
}

#footer ul li #mainBlogButton {
	background: url(cssimage/blog_icon.png) 50% 50% no-repeat;
	width: 64px;
	height: 55px;
	float: left;
	background-size: 92%;
}

#footer ul li #mainBlogButton:hover {
	background: url(cssimage/tap_blog_icon.png) 50% 50% no-repeat;
}

#footer ul li #mainPartyButton {
	background: url(cssimage/party_icon.png) 50% 50% no-repeat;
	width: 64px;
	height: 55px;
	float: left;
	background-size: 92%;
}

#footer ul li #mainPartyButton:hover {
	background: url(cssimage/tap_party_icon.png) 50% 50% no-repeat;
}

#footer ul li #mainLoungeButton {
	background: url(cssimage/lounge_icon.png) 50% 50% no-repeat;
	width: 64px;
	height: 55px;
	float: left;
	background-size: 92%;
}

#footer ul li #mainLoungeButton:hover {
	background: url(cssimage/tap_lounge_icon.png) 50% 50% no-repeat;
}

#footer ul li #mainSettingButton {
	background: url(cssimage/setting_icon.png) 50% 50% no-repeat;
	width: 64px;
	height: 55px;
	float: left;
	background-size: 92%;
}

#footer ul li #mainSettingButton:hover {
	background: url(cssimage/tap_setting_icon.png) 50% 50% no-repeat;
}

#id_header {
	text-align: center;
	background-color: gray;
	opacity: 0.6;
	margin: 0;
	width: 100%;
	font-size: 25px;
	color: black;
}

#list {
	shadow: false;
	margin: 0;
	border: none;
	width: 17%;
	height: 100%;
	float: right;
}

#list img {
	margin-top: 25%;
	widows: 45%;
	height: 45%;
	margin-left: 6%;
	border-radius: 0;
}

#line_right {
	padding: 0;
	margin-top: 0;
	margin-right: 4%;
	height: 90%;
	width: 5%;
	float: left;
	background-image: url(cssimage/header_line.png);
}

#back {
	shadow: false;
	margin: 0;
	padding: 0;
	margin-top: 3.5%;
	border: none;
	width: 17%;
	height: 100%;
}

#line_left {
	padding: 0;
	margin: 0;
	height: 90%;
	width: 5%;
	float: right;
	background-image: url(cssimage/header_line.png);
}

#back img {
	margin-top: 10%;
	height: 70%;
	border-radius: 0;
}

#header_title {
	margin-top: 15%;
	font-size: 30px;
}

#insertText {
	margin: 0;
	display: inline;
	width: 80%;
	size: 80%;
	display: inline;
}

#submitButton {
	margin: 0;
	margin-right: 1.5%;
	width: 13%;
	height: 8%;
	background-color: #fff8dc;
	opacity: 0.8;
	display: inline;
	float: right;
}
</style>
	<header data-role="header" data-position="fixed" id="header">
		<div id="back" class="ui-btn-left">
			<img src="cssimage/back_btn.png">
			<div id="line_left"></div>
		</div>

		<h1>담벼락</h1>

		<div id="list" class="ui-btn-right">
			<div id="line_right"></div>
			<img src="cssimage/category_btn.png">
		</div>

	</header>

	<div id="id_header"></div>

	<section data-role="content" data-role="fieldcontain" id="content">

		<ul data-role="listview" id="wallList">
		</ul>

	</section>

	<div id="input_text">
		<input type="text" id="insertText" value="" /> <img
			src="cssimage/blog_write_btn.png" id="submitButton">

	</div>
	<footer data-role="footer" id="footer" data-position="fixed"
		data-tap-toggle="false">
		<ul>
			<li><a href="talkList.html" id="mainStalkButton"></a></li>
			<li><a href="clubList.html" id="mainBlogButton"></a></li>
			<li><a href="lounge.html" id="mainPartyButton"></a></li>
			<li><a href="blog.html" id="mainLoungeButton"></a></li>
			<li><a href="setting.html" id="mainSettingButton"></a></li>
		</ul>

	</footer>

</div>